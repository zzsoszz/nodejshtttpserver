!function(a){function b(a){x=a.document.width,y=a.document.height,z=f(a),d(x),e(),s(C,z),t(),c(B),u(),v()}function c(a){var b=".layer",c="layer-hover",d="layer-selected",f="s-prop-pannel",h=$("#js-zoom"),j=".plus",n=".minus",o=".text",p=$("#js-resolution"),q=$("#js-resolution-list"),s="resolution-list";a.on("click",b,function(a){var c=$(this),e=c.position(),f=(c.outerWidth(),c.outerHeight(),e.top,e.left,$(this).data("markid"));L||($(this).addClass(d).siblings(b).removeClass(d),E=!0,F=f,l("hide"),m(c),i(f),k("on"),a.stopPropagation())}),a.on("mouseenter",b,function(){var a=$(this),b=a.position(),e=a.outerWidth(),f=a.outerHeight(),g=a.data("markid"),h=b.top,i=b.left;L||$(this).hasClass(d)||($(this).addClass(c),l({width:e,height:f,top:h,left:i,markId:g}),m("hide"))}),a.on("mouseleave",b,function(){$(this).removeClass(c),l("hide"),!$(this).hasClass(d)&&E&&m("show")}),$(document).on("click",function(b){!$(b.target).hasClass(f)&&$(b.target).parents("."+f).length<1&&(k("off"),a.find("."+d).removeClass(d),m("hide"),E=!1),!$(b.target).hasClass(s)&&$(b.target).parents("."+s).length<1&&q.hide()}),h.on("click",j,function(a){var b=$.inArray(G,H),c=$(this),f=H.length;0>b||b>f-2||(0===b&&h.find(n).removeClass("disable"),b++,g(H[b],function(){b===f-1&&c.addClass("disable"),e(),r(function(){m($("."+d))}),h.find(o).text(100*G+"%")}),a.stopPropagation())}),h.on("click",n,function(a){var b=$.inArray(G,H),c=$(this),f=H.length;1>b||(b===f-1&&h.find(j).removeClass("disable"),b--,g(H[b],function(){0===b&&c.addClass("disable"),e(),r(function(){m($("."+d))}),h.find(o).text(100*G+"%")}),a.stopPropagation())}),p.on("click",function(a){q.show(),a.stopPropagation()}),q.on("click","div",function(a){var b,c=parseInt($(this).data("rindex"));return a.stopPropagation(),c==K?void q.hide():(K=c,$(this).addClass("current").siblings().removeClass("current"),p.html($(this).html()),q.hide(),void(E&&(b=$("."+d).data("markid"),i(b),m($("."+d)))))})}function d(a){var b=$("#js-zoom"),c=".plus",d=".minus",e=".text",f="disable";a>M?G=.5:(G=1,b.find(c).addClass(f),b.find(d).removeClass(f),b.find(e).text(100*G+"%"))}function e(){B.css({width:x*G,height:y*G})}function f(a){var b,c,d=a,e=d.children.reverse(),g=e.length;for(b=0;g>b;b++)c="mark_"+J,e[b].markId=c,J++,"group"==e[b].type&&(e[b]=f(e[b])),I[c]=e[b];return d.children=e,d}function g(a,b){G=a,"function"==typeof b&&b()}function h(a){var b,c,d,e=[],f=[],g=a.font,h=g.sizes||[],i=g.colors;for(b=g.name,c=0;c<h.length;c++)c>0&&h[c]==h[c-1]||e.push(j(Math.round(h[c]*a.transform.xx)));for(c=0;c<i.length;c++){for(var k="#",l={},m=0;3>m;m++)k+=("0"+Number(i[c][m]).toString(16)).slice(-2);(0==c||k!==f[f.length-1].hex.toLowerCase())&&(l.hex=k.toUpperCase(),l.rgb="RGB("+i[c].slice(0,3)+")",f[f.length]=l)}return d=g.lineHeight?g.lineHeight[0]:void 0,{family:b,size:e.join(","),colors:f,text:a.value,lineHeight:j(d)}}function i(a){var b=$("#js-detail-wrap"),c=b.find(".s-prop-pannel"),d=(c.outerWidth(),I[a]),e=n(a),f="",g={},i="";if(g.width=j(e.width),g.height=j(e.height),g.opacity=d.opacity,e.vectorData&&e.vectorData.shape){var k=e.vectorData.shape.borderRadius,l="";k.topLeft==k.topRight==k.bottomLeft==k.bottomRight?(l+="圆角：",l+=j(k.topLeft)):(l+="圆角(上右下左)：",l+=[j(k.topLeft),j(k.topRight),j(k.bottomRight),j(k.bottomLeft)].join(", ")),i+=['<p class="row-prop">',"<span>"+l+"</span>","</p>"].join("")}if(f+=['<div class="item">','<h2 class="item-hd g-clearfix"><span class="item-name">属性</span></h2>','<div class="prop-list">','<p class="row-prop">',"X,Y坐标："+j(e.left)+"，"+j(e.top),"</p>",'<p class="row-prop"><span class="prop prop-width">宽度：'+g.width+'</span><span class="prop">高度：'+g.height+"</span></p>",'<p class="row-prop">',"<span>opcity："+g.opacity+"</span>","</p>",i,"</div>","</div>"].join(""),d.text){var m=h(d.text),o="",p="";$.each(m.colors,function(a,b){o+=['<dl class="color-list g-clearfix">','<dt class="dot-color" style="background-color:'+b.hex+'"></dt>',"<dd>"+b.hex+"<br />"+b.rgb+"</dd>","</dl>"].join("")}),m.lineHeight&&(p+=['<p class="row-prop">','<span class="prop">行高：'+m.lineHeight+"</span>","</p>"].join("")),f+=['<div class="item">','<h2 class="item-hd"><span class="item-name">字体</span></h2>','<div class="prop-list">','<p class="row-prop"><span class="prop">字体：'+m.family+"</span></p>",'<p class="row-prop">','<span class="prop">大小：'+m.size+"</span>","</p>",p,'<div class="row-prop prop-font-color g-clearfix">','<span class="prop">颜色：</span>','<div class="font-colors">',o,"</div>","</div>",'<p class="row-prop">','<span class="prop">文字内容：</span>','<span class="prop-font-content">'+m.text+"</span>","</p>","</div>","</div>"].join("")}if(e.vectorData){var q=[],r=e.vectorData.effects,s="";r&&(r.colorOver||r.gradientOver)?r.colorOver?q.push(r.colorOver.color):q=r.gradientOver.color:q.push(e.vectorData.bgColor),$.each(q,function(a,b){s+=['<dl class="color-list g-clearfix">','<dt class="dot-color" style="background-color:'+b.hex+'"></dt>',"<dd>"+b.hex+"<br />"+b.rgb+"</dd>","</dl>"].join("")}),f+=['<div class="item">','<h2 class="item-hd">','<span class="item-name">填充</span>',"</h2>",s,"</div>"].join("");var t=[];r&&r.stroke&&r.stroke.color&&(r.stroke.title="描边（图层样式）",t.push(r.stroke)),e.vectorData.stroke&&(e.vectorData.stroke.title="描边",t.push(e.vectorData.stroke)),t.length>0&&$.each(t,function(a,b){f+=['<div class="item">','<h2 class="item-hd">','<span class="item-name">'+b.title+"</span>","</h2>",'<p class="row-prop"><span>大小：'+j(b.size)+"</span></p>",'<dl class="color-list g-clearfix">','<dt class="dot-color" style="background-color:'+b.color.hex+'"></dt>',"<dd>"+b.color.hex+"<br />"+b.color.rgb+"</dd>","</dl>","</div>"].join("")})}c.html(f)}function j(a){var b=A[K];return Math.ceil(a/b.type)+b.units}function k(a){var b=$("#js-detail-wrap"),c=b.find(".s-prop-pannel"),d=b.find(".s-prop-blank"),e=150,f=300,g=200;"on"===a?(c.delay(e).fadeIn(f),d.fadeOut(g)):"off"===a&&(d.delay(e).fadeIn(f),c.fadeOut(g))}function l(a){var b,c,d,e,f,g,h,i,k,l,m,o,p,q,r,s,t,u,v,w,z,A,B=$("#guide-axis-x"),C=$("#guide-axis-y"),D=$("#guide-distance"),F=D.find(".distance-left"),H=D.find(".distance-right"),I=D.find(".distance-top"),J=D.find(".distance-bottom"),K=".distance-size",L=F.find(K),M=H.find(K),N=I.find(K),O=J.find(K),P=$(".layer-selected");if("object"==typeof a&&(b=a.width,c=a.height,d=a.top,e=a.left),"hide"===a||!E)return B.hide(),C.hide(),D.hide(),F.hide(),H.hide(),I.hide(),void J.hide();x>b&&y>c&&(B.css({width:x*G,height:c,top:d}).show(),C.css({width:b,height:y*G,left:e}).show()),z=n(a.markId),s=P.data("markid"),A=n(s),m=P.position(),k=P.width(),l=P.height(),f=m.top,h=m.left,i=h+k,g=f+l;var Q=e-i>0,R=d-g>0,S=f-d-c>0,T=h-e-b>0,U=e-h>0&&i-e-b>0&&d-f>0&&g-d-c>0,V=0>e-h&&0>i-e-b&&0>d-f&&0>g-d-c;Q&&(p=e-i,v=z.left-A.left-A.width,D.show(),L.text(j(v)),F.css({width:p-2,left:i+2,top:f+l/2}).show(),L.css({marginLeft:-L.outerWidth()/2})),T&&(r=h-e-b,w=A.left-z.left-z.width,D.show(),M.text(j(w)),H.css({width:r,left:e+b,top:f+l/2}).show(),M.css({marginLeft:-M.outerWidth()/2})),R&&(o=d-g,t=z.top-A.top-A.height,D.show(),N.text(j(t)),I.css({height:o-2,left:h+k/2,top:g+2}).show()),S&&(q=f-d-c,u=A.top-z.top-z.height,D.show(),O.text(j(u)),J.css({height:q,left:h+k/2,top:f-q}).show()),(U||V)&&(o=Math.abs(d-f),q=Math.abs(d+c-g),p=Math.abs(e-h),r=Math.abs(e+b-i),t=Math.abs(z.top-A.top),u=Math.abs(z.top+z.height-(A.top+A.height)),v=Math.abs(z.left-A.left),w=Math.abs(z.left+z.width-A.left-A.width),D.show(),N.text(j(t)),O.text(j(u)),L.text(j(v)),M.text(j(w)),I.css({height:o,left:h+k/2,top:Math.min(d,f)}).show(),J.css({height:q,left:h+k/2,top:Math.min(d+c,g)}).show(),F.css({width:p-2,left:Math.min(e,h)+2,top:f+l/2}).show(),L.css({marginLeft:-L.outerWidth()/2}),H.css({width:r,left:Math.min(e+b,i),top:f+l/2}).show(),M.css({marginLeft:-M.outerWidth()/2}))}function m(a){var b,c,d,e,f,g,h,i,k,l,m,o=$("#guide-size"),p=o.find(".js-box-width"),q=o.find(".js-box-height"),r=20,s=5;return"string"==typeof a?void("hide"==a?(p.hide(),q.hide()):"show"==a&&(p.show(),q.show())):void(a.length<1||(h=a.position(),i=a.outerWidth(),k=a.outerHeight(),l=h.top,m=h.left,g=a.data("markid"),f=n(g),p.text(j(f.width)),q.text(j(f.height)),b=l-r-s,c=m+i/2-p.width()/2,d=l+k/2-r/2,e=m+i+s,p.css({top:b,left:c}).show(),q.css({top:d,left:e}).show()))}function n(a,b){var c,d,e,f,g,h,i,j,k=b?G:1,l=null;return c="string"==typeof a?I[a]:a,k=b?G:1,"undefined"==typeof c.mask.disabled||c.mask.disabled?(d=c.top,e=c.left,g=c.bottom,f=c.right,h=c.width,i=c.height):(d=c.mask.top,e=c.mask.left,g=c.mask.bottom,f=c.mask.right,h=c.mask.width,i=c.mask.height,c.mask.disabled===!1&&(d+=1,g-=1,e+=1,f-=1,h-=2,i-=2)),0>g||0>f||d>y||e>x?j=!0:(j=!1,0>d&&(i+=d,d=0),g>y&&(i+=y-g,g=y),0>e&&(h+=e,e=0),f>x&&(h+=x-f,f=0)),d*=k,e*=k,h*=k,i*=k,(c.effectsData||c.vectorData||c.vectorColor)&&(l=o(c)),{top:d,left:e,width:h,height:i,isOut:j,vectorData:l}}function o(a){var b,c,d,e,f={},g=a.vectorColor,h=a.effectsData,i=a.vectorData,j=a.vectorStroke,k=a.vectorStrokeContent,l={};if(g?(f.bgColor={},f.bgColor.rgb="RGB("+g.join(",")+")",f.bgColor.hex=q(g)):k?(f.bgColor={},g=p(k["Clr "]),f.bgColor.rgb="RGB("+g.join(",")+")",f.bgColor.hex=q(g)):f.bgColor=null,j){var m=[],n=j.strokeStyleContent["Clr "];n&&(f.stroke={},f.stroke.color={},m=p(n),f.stroke.color.rgb="RGB("+m.join(",")+")",f.stroke.color.hex=q(m),f.stroke.size=j.strokeStyleLineWidth.value)}return h&&(f.effects={},b=h.FrFX,c=h.SoFi,d=h.GrFl,b&&b.enab?(l.type=b.PntT.value,l.opacity=b.Opct.value,l.angle=b.Angl?b.Angl.value:null,l.size=b["Sz  "].value,"SClr"==l.type?(l.color={},e=p(b["Clr "]),l.color.rgb="RGB("+e.join(",")+")",l.color.hex=q(e)):"GrFl"==l.type?(l.grad={},l.grad.color=[],$.each(b.Grad.Clrs,function(a,b){var c={};e=p(b["Clr "]),c.rgb="RGB("+e.join(",")+")",c.hex=q(e),l.grad.color.push(c)})):"Ptrn"==l.type,f.effects.stroke=l):f.effects.stroke=null,c&&c.enab&&(f.effects.colorOver={},e=p(c["Clr "]),f.effects.colorOver.color={rgb:"RGB("+e.join(",")+")",hex:q(e)},f.effects.colorOver.opacity=c.Opct.value),d&&d.enab&&(f.effects.gradientOver={color:[]},$.each(d.Grad.Clrs,function(a,b){var c={};e=p(b["Clr "]),c.rgb="RGB("+e.join(",")+")",c.hex=q(e),f.effects.gradientOver.color.push(c)}))),i&&$.isArray(i.keyDescriptorList)&&1==i.keyDescriptorList.length&&2==i.keyDescriptorList[0].keyOriginType&&(f.shape={},f.shape.borderRadius={topLeft:i.keyDescriptorList[0].keyOriginRRectRadii.topLeft.value,topRight:i.keyDescriptorList[0].keyOriginRRectRadii.topRight.value,bottomRight:i.keyDescriptorList[0].keyOriginRRectRadii.bottomRight.value,bottomLeft:i.keyDescriptorList[0].keyOriginRRectRadii.bottomLeft.value}),f}function p(a){return[Math.round(a["Rd  "]),Math.round(a["Grn "]),Math.round(a["Bl  "])]}function q(a){var b,c="#";if($.isArray(a))b=a;else{if("string"!=typeof a)return null;b=a.match(/\d+/gi)}return c+=("0"+Number(b[0]).toString(16)).slice(-2),c+=("0"+Number(b[1]).toString(16)).slice(-2),c+=("0"+Number(b[2]).toString(16)).slice(-2),c.toUpperCase()}function r(a){C.html(""),s(C,z),a&&a()}function s(a,b,c){var d,e,f,g,h=b.children,i=h.length,j=0,k={},l="layer-selected",m=/^(\{box\}|\#\s?box|\/\/\s?box)$/;for(j;i>j;j++)if(h[j].visible&&!h[j].clipped)if("group"==h[j].type)f=h[j],s(a,f,!0);else{if(e=['<div class="layer" data-name="'+h[j].name+'">','<span class="dot dot-lt"></span>','<span class="dot dot-rt"></span>','<span class="dot dot-lb"></span>','<span class="dot dot-rb"></span>',"</div>"].join(""),d=$(e),m.test(h[j-1]&&h[j-1].name)?(k=n(h[j-1],!0),g=h[j-1].markId):(g=h[j].markId,k=n(h[j],!0)),k.isOut)continue;d.css(k),E&&F==g&&d.addClass(l),d.data("markid",g),a.append(d)}}function t(){for(var a,b,c,d=$("#js-resolution-list"),e=$("#js-resolution"),f=0;f<A.length;f++)$.inArray(x,A[f].width)>-1?(K=f,c="current",e.find("span").text(A[f].name)):c="",a="<div></div>",b=$("<span></span>"),b.addClass(A[f].device).text(A[f].name),$(a).data("rindex",f).addClass(c).html(b).appendTo(d);0==K&&d.find("div").eq(0).addClass("current")}function u(){function a(a,b){var c,e,g,h,i,j,k,l;return c=b*d+a,c=4*c,i=f[c],j=f[c+1],k=f[c+2],l=(f[c+3]/255).toFixed(2),e="RGB("+i+","+j+","+k+")",g=[i,j,k].join(","),h="#"+("0"+i.toString(16)).slice(-2)+("0"+j.toString(16)).slice(-2)+("0"+k.toString(16)).slice(-2),{rgba:e,hex:h.toUpperCase(),rgb:g}}function b(){g&&(clearTimeout(g),g=null),g=setTimeout(function(){o.fadeOut(300)},8e3)}var c,d,e,f,g,h=D.find("img").attr("src"),i=$("#js-color-wrap"),j=document.createElement("canvas"),k=j.getContext("2d"),l=".js-color-tools",m="color-tool-selected",n=$('<div class="s-color-zoom"></div>'),o=i.find(".js-color-display");c=new Image,c.src=h,n.append('<img class="zoom-img" src="'+h+'" />'),n.append('<div class="zoom-desc"></div>'),n.appendTo("body"),c.onload=function(){d=j.width=c.width,e=j.height=c.height,k.drawImage(c,0,0);for(var a=k.getImageData(0,0,c.width,c.height).data,b=0,g=a.length;g>b;b+=4){a[b],a[b+1],a[b+2],a[b+3]}f=a},i.on("click",l,function(){L=!L,i.toggleClass(m)}),C.on("click",function(){return L?(L=!1,i.removeClass(m),n.hide(),b(),!1):void 0}),$(document).on("mousemove",function(c){if(L){var f,h,j,k,l,m,p,q=B.offset(),r=".color-ico",s=".js-value",t=4,u=60,v=34,w="";f=parseInt(q.left),h=parseInt(q.top),j=c.pageX,k=c.pageY,l=Math.round((j-f)/G),m=Math.round((k-h)/G),g&&(clearTimeout(g),g=null),j>f&&f+d*G>j&&k>h&&h+e*G>k?(p=a(l,m),i.find(r).css({"background-color":p.hex}),i.find(s).text(p.hex+" / "+p.rgba),n.find(".zoom-img").css({width:d*t,left:u-l*t,top:v-m*t}),w=["<p>x,y："+l+","+m+"</p>","<p>Hex："+p.hex+"</p>","<p>RGB："+p.rgb+"</p>"].join(""),n.find(".zoom-desc").html(w),o.show(),n.show().css({left:j+20,top:k+20})):(n.hide(),b())}})}function v(){var a,b,c=($("#js-detail-wrap .layout-main"),$(".js-changebg")),d="i-mark-layer",e="i-psd-header",f="s-prop-pannel",g=".current",h="i-wrapper-bg";$(document).on("mousemove",function(a){var b=$(a.target);b.hasClass(d)||b.parents("."+d).length>0||b.hasClass(e)||b.parents("."+e).length>0||b.hasClass(f)||b.parents("."+f).length>0?c.hide():c.show()}),a=c.find(g).css("background"),orginSty=h+" "+c.find(g).data("wrap"),c.find("li").on({mouseenter:function(){b&&(clearTimeout(b),b=null);var a=$(this).css("background"),c=h+" "+$(this).data("wrap");$("html").css({background:a}).removeClass().addClass(c)},mouseleave:function(){b&&(clearTimeout(b),b=null),b=setTimeout(function(){$("html").css({background:a}).removeClass().addClass(orginSty)},200)},click:function(){var b=$(this).css("background"),c=h+" "+$(this).data("wrap");orginSty=c,a=b,$(this).addClass(g.slice(1)),$(this).siblings().removeClass(g.slice(1))}})}var w,x,y,z,A,B=$("#mark-layer"),C=(document.getElementById("dropzone"),B.find(".js-layers")),D=B.find(".js-origin-img"),E=!1,F="",G=.5,H=[.5,.75,1],I={},J=0,K=0,L=!1,M=749;A=[{type:1,name:"标准标注（px）",units:"px",device:"pc",width:[]},{type:1,name:"iphone @1x (pt)",units:"pt",device:"iphone",width:[320,375,414,272,312]},{type:2,name:"iphone @2x (pt)",units:"pt",device:"iphone",width:[640,750]},{type:3,name:"iPhone @3x (pt)",units:"pt",device:"iphone",width:[1080,1242]},{type:.75,name:"LDPI @0.75x (dp)",units:"dp",device:"android",width:[270]},{type:1,name:"MDPI @1x (dp)",units:"dp",device:"android",width:[360]},{type:1.5,name:"HDPI @1.5x (dp)",units:"dp",device:"android",width:[540]},{type:2,name:"XHDPI @2x (dp)",units:"dp",device:"android",width:[720]},{type:3,name:"XXHDPI @3x (dp)",units:"dp",device:"android",width:[]},{type:4,name:"XXXHDPI @4x (dp)",units:"dp",device:"android",width:[1440]}],w=a.BNM=a.BNM||{},w.psdMark=b}(this),BNM.nameSpace("detail.nav"),BNM.detail.nav=function(){var a=$("#js-slider-bar"),b=$("#js-detail-wrap .s-detail-nav"),c=$("#js-detail-wrap .layout-main"),d="s-detail-nav-hide",e=$(".js-changebg"),f=b.outerWidth();a.on("click",function(){b.hasClass(d)?(b.removeClass(d),c.css({left:f}),e.css({left:f+20})):(b.addClass(d),c.css({left:0}),e.css({left:20}))})},BNM.detail.nav(),BNM.detail.followLayer=function(){function a(){c.fadeOut(300)}function b(){c.fadeIn(300)}var c=$("#js-follow-layer"),d=".js-follow-close",e=".layer-wrap";return c.find(d).on("click",function(){a()}),c.on("click",function(){a()}),c.find(e).on("click",function(){return!1}),{open:b,close:a}}(),$("#export-pattern").click(function(){var a=$(this);return a.hasClass("noActivate")?void $.get("/isActivate",function(b){b.status?window.location.href=a.data("href"):BNM.detail.followLayer.open()}):!0});